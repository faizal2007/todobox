
<!-- Flatpickr CSS and JS for datetime picker -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<style>
    #reminder-datetime {
        width: 100% !important;
        height: 40px !important;
        padding: 12px !important;
        font-size: 16px !important;
        background-color: white !important;
        border: 1px solid #ced4da !important;
        border-radius: 4px !important;
        box-sizing: border-box !important;
    }
    .flatpickr-calendar {
        box-shadow: 0 3px 13px rgba(0,0,0,0.08);
        border-radius: 6px;
    }
    .flatpickr-time input {
        font-size: 14px;
    }
</style>

<!-- Info Header Modal -->
<div id="info-header-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="info-header-modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header modal-colored-header bg-primary">
                <h4 class="modal-title" id="info-header-modalLabel">{{ form_title }}</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
            </div>
			<form class="need-validations" novalidate>
				<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
				<input type="hidden" name="todo_id"/>
				<div class="modal-body">
					<div class="form-group position-relative mb-3">
						<label for="title-input-normal">Thinking ....</label>
						<input type="text" id="title-input-normal" name="title-input-normal" class="form-control form-control-sm" placeholder="Anything ??" required>
						<div class="valid-tooltip">
							Looks good!
						</div>
						<div class="invalid-tooltip">
							What do you want to do ???.
						</div>
					</div>
					<div class="form-group">
						<label for="details-textarea">Why ???</label>
						<textarea class="form-control" id="details-textarea" rows="5"></textarea>
					</div>
					
					<!-- Schedule/Day Selection -->
					<div class="form-group">
						<label>Schedule for:</label>
						<div class="btn-group btn-group-toggle d-block" data-toggle="buttons">
							<label class="btn btn-outline-primary btn-sm active" for="today" id="today-button">
								<input type="radio" name="schedule_day" id="today" value="today" checked autocomplete="off"> Today
							</label>
							<label class="btn btn-outline-primary btn-sm" for="tomorrow" id="tomorrow-button">
								<input type="radio" name="schedule_day" id="tomorrow" value="tomorrow" autocomplete="off"> Tomorrow
							</label>
							<label class="btn btn-outline-primary btn-sm" for="custom_day">
								<input type="radio" name="schedule_day" id="custom_day" value="custom" autocomplete="off"> Custom Date
							</label>
						</div>
						<!-- Add some custom CSS for better visual feedback -->
						<style>
							.btn-group-toggle .btn.active {
								background-color: #007bff !important;
								border-color: #007bff !important;
								color: #fff !important;
							}
							.btn-group-toggle .btn:not(.active) {
								background-color: transparent;
								color: #007bff;
							}
						</style>
						<div class="mt-2" id="custom-date-picker" style="display: none;">
							<input type="date" class="form-control form-control-sm" id="custom_date" name="custom_date">
						</div>
					</div>
					
					<!-- Reminder Section -->
					<div class="form-group">
						<div class="custom-control custom-checkbox">
							<input type="checkbox" class="custom-control-input" id="reminder-enabled" name="reminder-enabled">
							<label class="custom-control-label" for="reminder-enabled">
								<i class="mdi mdi-bell-outline mr-1"></i>Set Reminder
							</label>
						</div>
					</div>
					
					<div class="form-group" id="reminder-options" style="display: none; padding-left: 1.5rem;">
						<label for="reminder-type">Remind me:</label>
						<div class="btn-group btn-group-toggle d-block mb-3" data-toggle="buttons">
							<label class="btn btn-outline-secondary btn-sm active" for="reminder-custom">
								<input type="radio" name="reminder_type" id="reminder-custom" value="custom" checked autocomplete="off"> At Specific Time
							</label>
							<label class="btn btn-outline-secondary btn-sm" for="reminder-before">
								<input type="radio" name="reminder_type" id="reminder-before" value="before" autocomplete="off"> Before Target
							</label>
						</div>
						
					<!-- Custom reminder time -->
					<div id="reminder-custom-time" class="mb-3">
						<label for="reminder-datetime" class="form-label">Date & Time:</label>
						<input type="text" id="reminder-datetime" name="reminder-datetime" placeholder="Select date and time" class="form-control">
					</div>
					<script>
						document.addEventListener('DOMContentLoaded', function() {
							// Update schedule button labels with actual dates
							function updateScheduleLabels() {
								const todayButton = document.getElementById('today-button');
								const tomorrowButton = document.getElementById('tomorrow-button');
								
								if (todayButton) {
									const today = new Date();
									const todayFormatted = today.toLocaleDateString('en-US', { 
										weekday: 'short',
										month: 'short', 
										day: 'numeric' 
									});
									const todayRadio = todayButton.querySelector('input[type="radio"]');
									const isActive = todayButton.classList.contains('active');
									todayButton.innerHTML = todayRadio.outerHTML + ` Today (${todayFormatted})`;
									// Restore active state if it was active
									if (isActive) {
										todayButton.classList.add('active');
									}
								}
								
								if (tomorrowButton) {
									const tomorrow = new Date();
									tomorrow.setDate(tomorrow.getDate() + 1);
									const tomorrowFormatted = tomorrow.toLocaleDateString('en-US', { 
										weekday: 'short',
										month: 'short', 
										day: 'numeric' 
									});
									const tomorrowRadio = tomorrowButton.querySelector('input[type="radio"]');
									const isActive = tomorrowButton.classList.contains('active');
									tomorrowButton.innerHTML = tomorrowRadio.outerHTML + ` Tomorrow (${tomorrowFormatted})`;
									// Restore active state if it was active
									if (isActive) {
										tomorrowButton.classList.add('active');
									}
								}
							}
							
							// Update labels on page load
							updateScheduleLabels();
							
							// Initialize Flatpickr for date and time selection
							const reminderInput = document.getElementById('reminder-datetime');
							
							// Check if Flatpickr is already initialized to prevent recursion
							if (reminderInput && !reminderInput._flatpickr) {
								flatpickr('#reminder-datetime', {
									enableTime: true,
									dateFormat: 'Y-m-d\\TH:i',
									altInput: true,
									altFormat: 'Y-m-d h:i K',
									time_24hr: false,
									minuteIncrement: 1,
									minDate: 'today',
									defaultDate: new Date(),
									static: false,
									inline: false,
									mode: 'single',
									theme: 'light',
									weekNumbers: true,
									allowInput: true,
									closeOnSelect: true
								});
							}
						});
						
						// Also initialize when modal is shown (for dynamic content)
						// Use vanilla JavaScript since jQuery may not be loaded yet
						document.addEventListener('DOMContentLoaded', function() {
							document.addEventListener('shown.bs.modal', function(event) {
								if (event.target && event.target.id === 'info-header-modal') {
									// Update schedule button labels when modal opens
									const todayButton = document.getElementById('today-button');
									const tomorrowButton = document.getElementById('tomorrow-button');
									
									if (todayButton) {
										const today = new Date();
										const todayFormatted = today.toLocaleDateString('en-US', { 
											weekday: 'short',
											month: 'short', 
											day: 'numeric' 
										});
										const todayRadio = todayButton.querySelector('input[type="radio"]');
										const isActive = todayButton.classList.contains('active');
										todayButton.innerHTML = todayRadio.outerHTML + ` Today (${todayFormatted})`;
										// Restore active state if it was active
										if (isActive) {
											todayButton.classList.add('active');
										}
									}
									
									if (tomorrowButton) {
										const tomorrow = new Date();
										tomorrow.setDate(tomorrow.getDate() + 1);
										const tomorrowFormatted = tomorrow.toLocaleDateString('en-US', { 
											weekday: 'short',
											month: 'short', 
											day: 'numeric' 
										});
										const tomorrowRadio = tomorrowButton.querySelector('input[type="radio"]');
										const isActive = tomorrowButton.classList.contains('active');
										tomorrowButton.innerHTML = tomorrowRadio.outerHTML + ` Tomorrow (${tomorrowFormatted})`;
										// Restore active state if it was active
										if (isActive) {
											tomorrowButton.classList.add('active');
										}
									}
									
									const reminderInput = document.getElementById('reminder-datetime');
									if (reminderInput && !reminderInput._flatpickr) {
										flatpickr('#reminder-datetime', {
											enableTime: true,
											dateFormat: 'Y-m-d\\TH:i',
											altInput: true,
											altFormat: 'Y-m-d h:i K',
											time_24hr: false,
											minuteIncrement: 1,
											minDate: 'today',
											defaultDate: new Date(),
											static: false,
											inline: false,
											mode: 'single',
											theme: 'light',
											weekNumbers: true,
											allowInput: true,
											closeOnSelect: true
										});
									}
								}
							});
						});
					</script>						<!-- Before target date options -->
						<div id="reminder-before-options" style="display: none;" class="mb-3">
							<label for="reminder-before-minutes">Remind me before:</label>
							<div class="input-group input-group-sm">
								<input type="number" class="form-control" id="reminder-before-minutes" name="reminder-before-minutes" value="30" min="1" max="1440">
								<div class="input-group-append">
									<select class="custom-select" id="reminder-before-unit" name="reminder-before-unit">
										<option value="minutes">Minutes</option>
										<option value="hours">Hours</option>
										<option value="days">Days</option>
									</select>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-light btn-rounded" data-dismiss="modal">Close</button>
					<button type="button" class="create-todo btn btn-primary btn-rounded">
						<i class="mdi mdi-content-save create-icon"></i>
						<span class="create-loading" style="display: none;">
							<i class="mdi mdi-loading mdi-spin"></i>
						</span>
						Save changes
					</button>
				</div>
			</form>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
