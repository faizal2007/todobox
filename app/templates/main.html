<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>{{ config.TITLE }} - {{ title }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="Todo application to track down our daily activity" name="description" />
		<link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
		<meta name="theme-color" content="#ff5555">
		<!-- PWA & platform icons -->
		<link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='assets/icons/icon-192x192.png') }}">
		<link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='assets/icons/icon-512x512.png') }}">
		<link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='assets/icons/icon-192x192.png') }}">
		<link rel="mask-icon" href="{{ url_for('static', filename='assets/images/logo.svg') }}" color="#ff5555">
        <!-- App favicon -->
		
		<link rel="shortcut icon" href='{{ url_for('static', filename='assets/images/favicon.ico') }}'>
        <!-- App css -->
        <link href='{{ url_for('static', filename='assets/css/icons.min.css') }}' rel="stylesheet" type="text/css" />
        <link href='{{ url_for('static', filename='assets/css/app-modern.min.css') }}' rel="stylesheet" type="text/css" id="light-style" />
        <link href='{{ url_for('static', filename='assets/css/app-modern-dark.min.css') }}' rel="stylesheet" type="text/css" id="dark-style" />
        <link href='{{ url_for('static', filename='css/style.css') }}' rel="stylesheet" type="text/css" />
    		<script type=text/javascript>
    			$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
				// Register service worker for PWA install prompt
				if ('serviceWorker' in navigator) {
					window.addEventListener('load', () => {
						navigator.serviceWorker.register('/service-worker.js');
					});
				}
				let deferredPrompt; 
				const btn = document.getElementById('pwa-install-btn');
				
				// Show install button when beforeinstallprompt event fires
				window.addEventListener('beforeinstallprompt', (e) => {
					e.preventDefault();
					deferredPrompt = e;
					if (btn) btn.style.display = 'inline-flex';
				});
				
				// Hide install button when app is installed
				window.addEventListener('appinstalled', () => {
					if (btn) btn.style.display = 'none';
					deferredPrompt = null;
				});
				
				// Hide button if app is already installed (on page load)
				if (window.navigator.getInstalledRelatedApps) {
					window.navigator.getInstalledRelatedApps().then(apps => {
						if (apps.length > 0) {
							if (btn) btn.style.display = 'none';
						}
					});
				}
				
				function installPWA() {
					if (!deferredPrompt) return;
					deferredPrompt.prompt();
					deferredPrompt.userChoice.then((result) => { 
						if (result.outcome === 'accepted') {
							if (btn) btn.style.display = 'none';
						}
						deferredPrompt = null; 
					});
				}
    		</script>
		{% block extra_css %}{% endblock %}
		{% block extra_script_header %}{% endblock %}
		<script 
			src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" 
			integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" 
			crossorigin="anonymous">
		</script>
        
    </head>
   
    <body class="loading" data-layout="topnav" data-layout-config='{"layoutBoxed":false,"darkMode":false,"showRightSidebarOnStart": true}'>
		<!-- Begin page -->
		<div class="wrapper">

			<!-- ============================================================== -->
			<!-- Start Page Content here -->
			<!-- ============================================================== -->

			<div class="content-page">
					<div class="content">
							<div class="navbar-custom topnav-navbar">
								<div class="container-fluid">
									<a href="{{ url_for('index') }}" class="topnav-logo">
										<p class="h3 text-muted app-title">{{ config.TITLE }}</p>
									</a>
										<a class="navbar-toggle" href="#" role="button" data-toggle="collapse" data-target="#topnav-menu-content" aria-controls="topnav-menu-content" aria-expanded="false" aria-label="Toggle navigation">
											<div class="lines">
												<span></span>
												<span></span>
												<span></span>
											</div>
										</a>
										{% if not current_user.is_anonymous %}
										<ul class="list-unstyled topbar-right-menu float-right mb-0">
											<li class="dropdown notification-list">
												<button id="pwa-install-btn" onclick="installPWA()">Install App</button>
												<a class="nav-link dropdown-toggle nav-user arrow-none mr-0" data-toggle="dropdown" id="topbar-userdrop" href="#" role="button" aria-haspopup="true"
													aria-expanded="false">
													<span class="account-user-avatar">
														<img src="https://www.gravatar.com/avatar/{{ current_user.email|lower|replace(' ', '')|md5 }}?s=32&d=identicon" alt="user-avatar" class="rounded-circle" referrerpolicy="no-referrer">
													</span>
													<span>
														<span class="account-user-name" title="{{ current_user.email }}">{{ current_user.email }}</span>
														<span class="account-position" id="current-date"></span>
													</span>
												</a>
												<div class="dropdown-menu dropdown-menu-right dropdown-menu-animated topbar-dropdown-menu profile-dropdown" aria-labelledby="topbar-userdrop">
													<!-- item-->
													<div class=" dropdown-header noti-title">
														<h6 class="text-overflow m-0">Welcome !</h6>
													</div>
				
													<!-- item-->
													<a href="{{ url_for('account') }}" class="dropdown-item notify-item">
														<i class="mdi mdi-account-circle mr-1"></i>
														<span>My Account</span>
													</a>
				
													<!-- item-->
													<a href="{{ url_for('settings') }}" class="dropdown-item notify-item">
														<i class="mdi mdi-account-edit mr-1"></i>
														<span>Settings</span>
													</a>

													{% if current_user.is_gmail_user() %}
													<!-- item - sharing (Gmail users only) -->
													<a href="{{ url_for('sharing') }}" class="dropdown-item notify-item">
														<i class="mdi mdi-share-variant mr-1"></i>
														<span>Sharing</span>
													</a>
													{% endif %}
				
													<!-- item-->
													<a href="{{ url_for('logout')}}" class="dropdown-item notify-item">
														<i class="mdi mdi-logout mr-1"></i>
														<span>Logout</span>
													</a>
				
												</div>
											</li>
										</ul>
										{% endif %}
								</div>
							</div>
						<div class="topnav">
							<div class="container-fluid">
								<nav class="navbar navbar-dark navbar-expand-lg topnav-menu">
										<div class="collapse navbar-collapse" id="topnav-menu-content">
											{% if not current_user.is_anonymous %}
											<ul class="navbar-nav">
												<li class="nav-item">
													<a class="nav-link arrow-none" href="{{ url_for('dashboard') }}" id="topnav-dashboard">
														<i class="uil-dashboard mr-1"></i>Dashboard
													</a>
												</li>
											</ul>
											{% endif %}
											{% if not current_user.is_anonymous %}
											<ul class="navbar-nav">
												<li class="nav-item dropdown">
													<a class="nav-link dropdown-toggle arrow-none" href="{{ url_for('list', id='today') }}" id="topnav-today">
														<i class="uil-notes mr-1"></i>Today 
													</a>
												</li>
											</ul>
											<ul class="navbar-nav">
												<li class="nav-item dropdown">
													<a class="nav-link dropdown-toggle arrow-none" href="{{ url_for('list', id='tomorrow') }}" id="topnav-tomorrow">
														<i class="uil-diary-alt mr-1"></i>Tomorrow
													</a>
												</li>
											</ul>
											<ul class="navbar-nav">
												<li class="nav-item dropdown">
													<a class="nav-link dropdown-toggle arrow-none" href="{{ url_for('undone') }}" id="topnav-undone">
														<i class="uil-list-ul mr-1"></i>Undone Tasks
													</a>
												</li>
											</ul>
											{% if current_user.is_gmail_user() %}
											<ul class="navbar-nav">
												<li class="nav-item dropdown">
													<a class="nav-link dropdown-toggle arrow-none" href="{{ url_for('shared_todos') }}" id="topnav-shared">
														<i class="mdi mdi-share-variant mr-1"></i>Shared
													</a>
												</li>
											</ul>
											{% endif %}
											{% if current_user.is_system_admin() %}
											<ul class="navbar-nav">
												<li class="nav-item dropdown">
													<a class="nav-link dropdown-toggle arrow-none" href="{{ url_for('admin_panel') }}" id="topnav-admin">
														<i class="mdi mdi-shield-account mr-1"></i>Admin
													</a>
												</li>
											</ul>
											{% endif %}
											{% endif %}
										</div>
								</nav>
							</div>
						</div>
					</div>

		{% block content %}{% endblock %}
        <!-- bundle -->
		
        <script src='{{ url_for('static', filename='assets/js/vendor.min.js') }}'></script>
        <script src='{{ url_for('static', filename='assets/js/app.min.js') }}'></script>
		
		<script>
			// Set current date using moment.js
			var currentDateEl = document.getElementById('current-date');
			if (currentDateEl) {
				currentDateEl.textContent = moment().format('MMMM DD, YYYY');
			}
		</script>
		
		{% block extra_script_footer %}{% endblock %}
        
    </body>
</html>